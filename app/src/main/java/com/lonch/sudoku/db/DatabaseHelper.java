/* 
 * Copyright (C) 2009 Roman Masek
 * 
 * This file is part of OpenSudoku.
 * 
 * OpenSudoku is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * OpenSudoku is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with OpenSudoku.  If not, see <http://www.gnu.org/licenses/>.
 * 
 */

package com.lonch.sudoku.db;

import android.content.Context;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;
import android.util.Log;

import com.lonch.sudoku.game.SudokuGame;

/**
 * This class helps open, create, and upgrade the database file.
 */
public class DatabaseHelper extends SQLiteOpenHelper {

    private static final String TAG = "DatabaseHelper";

    public static final int DATABASE_VERSION = 9;

    private Context mContext;

    DatabaseHelper(Context context) {
        super(context, SudokuDatabase.DATABASE_NAME, null, DATABASE_VERSION);
        this.mContext = context;
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        db.execSQL("CREATE TABLE " + SudokuDatabase.SUDOKU_TABLE_NAME + " ("
                + SudokuColumns._ID + " INTEGER PRIMARY KEY,"
                + SudokuColumns.FOLDER_ID + " INTEGER,"
                + SudokuColumns.CREATED + " INTEGER,"
                + SudokuColumns.STATE + " INTEGER,"
                + SudokuColumns.TIME + " INTEGER,"
                + SudokuColumns.LAST_PLAYED + " INTEGER,"
                + SudokuColumns.DATA + " Text,"
                + SudokuColumns.PUZZLE_NOTE + " Text,"
                + SudokuColumns.COMMAND_STACK + " Text"
                + ");");

        db.execSQL("CREATE TABLE " + SudokuDatabase.FOLDER_TABLE_NAME + " ("
                + FolderColumns._ID + " INTEGER PRIMARY KEY,"
                + SudokuColumns.CREATED + " INTEGER,"
                + FolderColumns.NAME + " TEXT"
                + ");");


        insertInitSudoku(db);
          createIndexes(db);
    }

    private void insertInitSudoku(SQLiteDatabase db) {
        String[] my81 = {
                "280500074070020500500306908095080000037400209020709103000100092803950700912640800",
                "506000980780060003090187050260905078050078102100003006940052001600000049800490025",
                "000900604096430080380072105010006050608509300053010240009100000002890567805203009",
                "017005000800200370250076018070590031084620000030000264305062007760009502001450003",
                "401070305000569024056003000900004600800390700740601230530810090100456873600000002",
                "070080940000406107914070003001900800897053026300800019562708300000009061030600208",
                "305460020000030500408201730053080402076502903009010005602004150900100046510306000",
                "405218003073000050020300409286700000019050078000082396030009081042560907960800000",
                "425001000090300051030059207060010008904280506508064002709042603340090100006007020",
                "000003600067189402048600703630200904000050030082346070490560020006002040800790065",
                "000265093003070002652030701009056004501042076800700300980020100025407038007500200",
                "053806091790050300060020400628007104100068020000201608000600500286030009530710062",
                "600401000920630081013008204801260340002710600040000020060850032409072000230006790",
                "000080040806040192014720600009802400463900018700060039048005700001008920600014850",
                "025000708013208500000409023030010906009820300086043250050790602001000035640105800",
                "960000380002380401031450060040523870020000100380900006408290010000047052205030740",
                "300800400007054002690700510019487006003260001540000807700609184060103005920008003",
                "005930007003008049680701203100800506040306010530029080760200400301095070000680301",
                "370021540950604000002080193040500008506208039080007600120800367035070000600012080",
                "526079000170004320000280056090030164760452900030000500087000005900120047012045800",
                "601280430003700000052600901140020600009468502520007340000006020805000004207941056"
        };


        String[] my822 = {"080020000040500320020309046600090004000640501134050700360004002407230600000700450",
                "608730000200000460000064820080005701900618004031000080860200039050000100100456200",
                "902040560000009000061250470040030102600480090003070080500008000306500947100360005",
                "018036040609080003000900860307600408050020007090400500062050084000070006084209001",
                "510000360000006000090253870902300040850600703000540080020160900100030050069070028",
                "067050030910800006000032790891400052600305080000010040006100204000003860780504000",
                "500072060970308051001000040450000810002405600007900005010020070204059030090600502",
                "300700081100300907209108000560000809700490060000860010040000078820610090010084020",
                "040901030060030007037004510004150720650708900000000100018090602020010350070502000",
                "004050029500491380930000000008060003000007002309204508051079064043000010000102005",
                "000750902005200006920008700890105000002400100004800579450900600000507091170600040",
                "080020000040500320020309046600090004000640501134050700360004002407230600000700450",
                "608730000200000460000064820080005701900618004031000080860200039050000100100456200",
                "902040560000009000061250470040030102600480090003070080500008000306500947100360005",
                "020001630090500400806049002900005701000900300352076800009004506080050000045600018",
                "034060901700012680080009000023050790007020005500078030010590000000000413078130020",
                "020604030450100206600005100004003000095201380200500907510000603807352000000000058",
                "032054900090001004080700031005600027800070000270140005000210300018907652603000000",
                "009000700080034065500027001400380096300400017908006000610009308023501070000060040",
                "710480060090050070004030908000040090080300020630208045000500000027001059560970201",
                "040085701950700800080006400370002000002008170600007082809023500400800010001050208",
                "050800300001040860308010002085230600003080007020090083560170498807400000000050700",
                "034580026080700301001002000026400030019370205000100090000000000500014760047063019",
                "670009020030005090900760504806090241020000009090682000007030410580000600300206070",
                "608043790002007016900600000500004180040030050800069040704005361020006005100078000",
                "007090004200000060830746210903604150002530007100000040001050693006903000040100005",
                "246908001700004200000010406030042080510009043800006000003475860460800032070000000",
                "920006301400008065005901000200010030000004750548200600004090020090000540103642800",
                "090068100028500004060200073800624700300000021902300400000000900450036000609150340",
                "018036040609080003000900860307600408050020007090400500062050084000070006084209001",
                "510000360000006000090253870902300040850600703000540080020160900100030050069070028",
                "067050030910800006000032790891400052600305080000010040006100204000003860780504000",
                "500072060970308051001000040450000810002405600007900005010020070204059030090600502",
                "300700081100300907209108000560000809700490060000860010040000078820610090010084020",
                "040901030060030007037004510004150720650708900000000100018090602020010350070502000",
                "004050029500491380930000000008060003000007002309204508051079064043000010000102005",
                "000750902005200006920008700890105000002400100004800579450900600000507091170600040"
        };
        String[]  my8156 = {

        "300000000050703008000028070700000043000000000003904105400300800100040000968000200",
                "302609005500730000000000900000940000000000109000057060008500006000000003019082040",
                "530000008007000030200006901000500200090370004000981000300040560000090000000007080",
                "008310900095000160000000005000400000000080049006072000000001030000240607001008200",
                "000400970000051600042000010030000000070508064000070000700030000300090000005864009",
                "060500000720000000000000320000050637000004500000230180180009000603070000004006003",
                "274000030000000005000600041900306000100280000006054000000000002007000583000095700",
                "570000069000003800090000000801600000000030600702000050000060501000702000006091032",
                "005200000400300700600000010800020100040800500000095000083040070090006080500902000",
                "400500600200000000000020000002004380000030000790000504000060490070093810500100030",
                "000790000001000000040050080000800027009003000000020403000040600004907100600501790",
                "060010000403700008520640000002000000009438005000006300004301200000200000005070000",
                "130400000705300000600020000000000027000900400000000085860500003059103000002004060",
                "020001048400000037071006020500000000000010802000809500090030400000040000000902060",
                "000000020006410035180020000008130406020000300600000000790005000004000008001300002",
                "040000200000007090000006010870020004901000028060030100006800041000070050005900000",
                "000030009048900000200470100125000080000080710000500000000090054061000003000050070",
                "000000060306000000000000805000605071005000300100870042900200014201080000000703000",
                "900000586008070004401000300002010900804005100000007000003008702000000000600040009",
                "000032970070045010000800000001060000000000000029000840500620007004000009100009036",
                "950003008800002000031000000060350090010007050000060010008000307000206009007000004",
                "000000000300027801100083000005001000001370060007004002200060070004000000900030650",
                "030207001000180670001030050000500900190004008000600020300700000000005080000020006",
                "600000004020507000000000031010900060000350109800000002240108000067090000003000006",
                "600095000000061802000000100500016000004000200002008036000002450040050000003400070",
                "201070800460000090080010040000050030030980051000006000004097000500000000090020700",
                "090000030100000800000312700050640007000730240080500000026000010000004300000050060"

    };
        String[]  my8132 = {
                "000689100800000029150000008403000050200005000090240801084700910500000060060410000",
                "030500804504200010008009000790806103000005400050000007800000702000704600610300500",
                "000013800807000020004090007030000050002340008070006004109027006080100005003800012",
                "400000020063407100500083060008000940030900008600802030000700504005000000807510200",
                "102030000000800904800609035305080740010070002000200300043702006600001200000000007",
                "206000005300000060000627010007230150004060000002900870600071090080050640003000001",
                "000803007009000300706090850020000080070600000400082579040031200502000060003020005",
                "708000309309180200000700008270600001000200803800010000005006000100307650037000002",
                "010003450000040002680500009070021960360000000000086730000000040023060801800059000",
                "050046010470010890000008020001003000300000068200079030009800003160007580700100000",
                "730000000200106400000080079000005006007001250615807003502000004080069000000400087",
                "005007000410980037000000081001650002040020900070040006030590008000073000058000074",
                "800040000006009040500780102903000500200038004000050290000005400050004020410200760",
                "900002006700009500040006008004061070037000000060230401000500084803020000025008009",
                "010004000700890051089007030070000360008540290050006000000709800040060510890000000",
                "006001000020009810090400075300017680200050001600000050501002000800000590900075003",
                "020807035009001006700600000360905800000004320900000000095400008001208000400006510",
                "000004000100803907908200005807030200501009008000040500000102000000007100612300870",
                "300500427025300008000200000600001309080600200007400000069002004008065700050000910",
                "307402800504000036000006200103200000000500608006700300000000920005620000830900064",
                "000304500006009070380006400510902064400000700000070000030100000600090341098003050"
        };
        String fname = "Begin";
        int cnt = 0;
        int folderID = 8;
        insertFolder(db, folderID, fname);
        for (int i = 0; i < my81.length; i++)
            insertSudoku(db, folderID, cnt++, fname, my81[i]);
        folderID++;
        fname = "middle";
        insertFolder(db, folderID, fname);
        for (int i = 0; i < my822.length; i++)
            insertSudoku(db, folderID,  cnt++ ,fname, my822[i]);

        folderID++;
        fname = "hard";
        insertFolder(db, folderID, fname);
        for (int i = 0; i < my8132.length; i++)
            insertSudoku(db, folderID,  cnt++ ,fname, my8132[i]);

        folderID++;
        fname = "expert";
        insertFolder(db, folderID, fname);
        for (int i = 0; i < my8156.length; i++)
            insertSudoku(db, folderID,  cnt++ ,fname, my8156[i]);


    }
    private void insertFolder(SQLiteDatabase db, long folderID, String folderName) {
		long now = System.currentTimeMillis();
		db.execSQL("INSERT INTO " + SudokuDatabase.FOLDER_TABLE_NAME + " VALUES (" + folderID + ", " + now + ", '" + folderName + "');");
	}

	// TODO: sudokuName is not used
	private void insertSudoku(SQLiteDatabase db, long folderID, long sudokuID, String sudokuName, String data) {
		String sql = "INSERT INTO " + SudokuDatabase.SUDOKU_TABLE_NAME + " VALUES (" + sudokuID + ", " + folderID + ", 0, " + SudokuGame.GAME_STATE_NOT_STARTED + ", 0, null, '" + data + "', null, null);";
		db.execSQL(sql);
	}

	@Override
	public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
		Log.i(TAG, "Upgrading database from version " + oldVersion + " to "
				+ newVersion + "");
		if (oldVersion <=7 ) {
			createIndexes(db);
		}

		if (oldVersion <= 8) {
			db.execSQL("ALTER TABLE " + SudokuDatabase.SUDOKU_TABLE_NAME + " ADD COLUMN " + SudokuColumns.COMMAND_STACK + " TEXT");
		}
	}

	private void createIndexes(SQLiteDatabase db) {
		db.execSQL("create index " + SudokuDatabase.SUDOKU_TABLE_NAME +
				"_idx1 on " +
				SudokuDatabase.SUDOKU_TABLE_NAME + " (" + SudokuColumns.FOLDER_ID + ");");
	}
}
